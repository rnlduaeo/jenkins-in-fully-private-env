credentials:
  system:
    domainCredentials:
    - credentials:
      - basicSSHUserPrivateKey:
          id: "59411e8e-742e-4e83-b7c3-f0327e8d285e"
          privateKeySource:
            directEntry:
              privateKey: "{-----BEGIN RSA PRIVATE KEY-----
MIIEpQIBAAKCAQEAxWR1zWiWHfI6hyEkuglxlJLHXPBRpuRrYRNNX/SXOehQA0v7
RXxb7COdGKdBEZo0gU8OnwGEEn5v0U4nkEka+hcZQfXJuadN2vgJ6VlvtXoieibx
ZaRSJAWMtg2G8jC/1tjkIvVwk0mbiiWOQ7xJaEwh0SJ+88Q4PRixpI9oRrUcMRue
mNM3PiDR7beTDDuYEUbPZHUnl6uSGzfIoADJl/Pks+9Y3XTiqbCFAID9rIJCKJct
Szvc87mw/oWL4ceiLr0joufEQtw/T7oGp+JMdE/gAEz+xZzQre0dpRjGeBmLb3XE
B0MrQiIbNH7lduXNd6KzNOLq4yJwCElMkwQjLwIDAQABAoIBAQCdUyZ5IuSS1Z9E
WGw3QpOeQSZYssnBZMkYxBOlaQKnCrvLBOIuTaHOIcxx+8xmxSsX7PTQUpr7Sn7A
qbPq0fmIXqSo58dyCyCIZ60uqTPZxpB4H1XDFybIwwuVhk6J9cTQ7mlWW5zwJ3iq
sKgk4Ir5b8R8NSxOCZRxTZ84c3w+7XAVnEWvMW7qtKTIl9wAy0/3Gmbw+2CDE5LQ
RnvEiiPpH9qNJOuPAh2pxOCBFJPVzQkcUYVJT8D69hWMj7Ijw8MXdK3zyyxDZGKD
aKqMUem9pLrxAONeWfLUBGL+xiE7MwgvzMZav+oBoR4zaqJi7G7LIQedHY1yrijS
GZ6OGclxAoGBAOhObX5OXVjDzQMG4BO1A1ULOG3uVvA2gqvqUO5nueKMc1rKbZ3x
XOcqU19kGanFvw57QZBmFuFY9t+bKC1+UMNkIRQaq21iFhWExFo67HwtUlsnO+fO
4DC68XLdgUmHZntFm9cvSisaa0OCcbKjPzdceBoiHETPkt6LlkTjH7s7AoGBANmG
a+00iZ6ga5cpRuKLQx5ms9lLXqhOgYymbANTGIbe8XM3K8NGIIbI/oHAGO0vFmgu
FMi5y3MUAdArZhRMKlTrcpTRbAuvC41pePjd77JiHDnTChHSS9Es2TA4EJAYwlZ1
rNhFf9f4D5xXbXShSyoAY1kfxIxf0pjd5O3UpfCdAoGBAJ3qIlhH4QCkKUqzc8Mx
u1AmTne8GvEzvOQsZlOJwzyTiR7gmF9TYXnqtb4Uh7V2rQelFc6Y91i8ZyVdjZRP
V4tbF3lZH8s9cBG0rN1BTNyk2mUIaJqNcKzvh44zsN1Q44NMsEE47kwaq2u60ptC
iYiSnTn2kgzcpdQOQ1oUos9dAoGAe+3jq18VUPSgl5yCsCsbcESfDpusMEOZ92IR
g8th2+VEtpmmKzjW6zO0HIQvL2J2Z6BpYvrHeKbbaZhwLfw+2ebSfwrZfcaa1FRV
AaSgHYdcAW3E/OZNH71nd9tZRF92yP9+HDFsZsUDT9VXnO0P/7v83hgFSNyHBWTW
OtG+QNkCgYEAipZ/N7S6RvapIIXEh/GURvrBgnlopjKoS4fbTVoA33MTGqKQ7qdJ
cBYE4XTWQLT12S5wa+AXh5SXKz0VBB2h5GOKCNzvli9vZS5bwM3NYqDb5jhqwcZg
WbBd5EKH7aNFOZifQ2perkVZ4LNEmT6GJ2GiDwMgiLtI/Y8Nnbbn564=
-----END RSA PRIVATE KEY-----}"
          scope: SYSTEM
          username: "ec2-user"
jenkins:
  agentProtocols:
  - "JNLP4-connect"
  - "Ping"
  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false
  clouds:
  - eC2Fleet:
      addNodeOnlyIfRunning: false
      alwaysReconnect: false
      cloudStatusIntervalSec: 10
      computerConnector:
        sSHConnector:
          credentialsId: "59411e8e-742e-4e83-b7c3-f0327e8d285e"
          launchTimeoutSeconds: 60
          maxNumRetries: 10
          port: 22
          retryWaitTime: 15
          sshHostKeyVerificationStrategy: "nonVerifyingKeyVerificationStrategy"
      disableTaskResubmit: false
      fleet: sfr-4c7569f1-d6b0-4052-8e1b-77f199f917a7
      idleMinutes: 5
      initOnlineCheckIntervalSec: 15
      initOnlineTimeoutSec: 180
      labelString: "spot-agent"
      maxSize: 3
      maxTotalUses: -1
      minSize: 1
      minSpareSize: 0
      name: "SpotFleet"
      noDelayProvision: false
      numExecutors: 1
      privateIpUsed: true
      region: "ap-northeast-2"
      restrictUsage: false
      scaleExecutorsByWeight: false
  crumbIssuer:
    standard:
      excludeClientIPFromCrumb: false
  numExecutors: 0
  remotingSecurity:
    enabled: true
  securityRealm:
    local:
      allowsSignup: false
      users:
      - id: "lgbss"
        password: AWSKorea12#$
        properties:
        - "apiToken"
        - timezone:
            timeZoneName: "Asia/Tokyo"
  slaveAgentPort: 50000
globalCredentialsConfiguration:
  configuration:
    providerFilter: "none"
    typeFilter: "none"
security:
  sSHD:
    port: -1
unclassified:
  buildDiscarders:
    configuredBuildDiscarders:
    - "jobBuildDiscarder"
  buildStepOperation:
    enabled: false
  buildTimestamp:
    enableBuildTimestamp: true
    pattern: "yyyy-MM-ddHHmmss"
    timezone: "Etc/GMT-9"
tool:
  git:
    installations:
    - home: "git"
      name: "Default"
  mavenGlobalConfig:
    globalSettingsProvider: "standard"
    settingsProvider: "standard"
  sonarRunnerInstallation:
    installations:
    - name: "SonarQubeScanner-4.7.0"
      properties:
      - installSource:
          installers:
          - sonarRunnerInstaller:
              id: "4.7.0.2747"
  jobs:
  - script: >
      pipelineJob('Docker Image Build Parent Pipeline') {
        definition {
          cps {
            script('''
              pipeline {
                // using the fleet instances that has the label 'spot-agent'
                agent {
                  label 'spot-agent'
                }
                stages {
                    stage('Clone source') {
                      steps {
                        sh 'echo '
                        sh 'sleep 120'
                        sh 'echo sleep is done'
                      }
                    }

                    stage('Triggering child pipeline') {
                        steps {
                            sh "echo 'Triggering child pipeline and pass the value > '"
                            build(job: 'childPipeline', parameters: [string(name: 'DOCKERTAG', value: env.)])
                        }
                    }
                }
              }'''.stripIndent())
              sandbox()
          }
        }
      }
  - script: >
      pipelineJob('Helm Chart Image Tag Update Child Pipeline') {
        definition {
          cps {
            script('''
              pipeline {
                  // using the fleet instances that has the label 'spot-agent'
                  agent {
                    label 'spot-agent'
                  }
                  
                  parameters {
                    string(name: 'DOCKERTAG', description: 'from parent jenkins job')
                  }
                  stages {
                      stage('See the value') {
                        steps {
                          sh 'echo child pipeline is triggered'
                        }
                      }  
                  }
              }'''.stripIndent())
              sandbox()
          }
        }
      }

